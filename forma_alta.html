<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Alta de alumnos</title>
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"/>
        <link rel="stylesheet" href="css/mdb.min.css" />
        <link rel="stylesheet" href="css/master.css" />
    </head>
    <body>
        <div class="container" class="cont-main">
            <div class="d-flex justify-content-center align-items-center" style="height: 100vh">
              <div class="text-center">
                <div class="form-outline">
                    <input type="text" id="user" class="form-control" onkeyup="minus(this)"/>
                    <label class="form-label" for="form1">Matricula</label>
                </div>
                <div class="form-outline">
                    <input type="text" id="first" class="form-control" />
                    <label class="form-label" for="form1">Nombre</label>
                </div>
                <div class="form-outline">
                    <input type="text" id="last" class="form-control" />
                    <label class="form-label" for="form1">Apellido</label>
                </div>
                
        
                <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="cbmoodle"
                    />
                    <label class="form-check-label" for="flexCheckChecked">
                      Moodle
                    </label>
                  </div>
                  
                  <!-- Checked checkbox -->
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      id="cboffice"
                      checked
                    />
                    <label class="form-check-label" for="flexCheckDefault">
                      Office
                    </label>
                  </div>
              </div>

              <button type="button" class="btn" onclick="addrow()" id="btnadd">AGREGAR</button>
              <button type="button" class="btn btn-primary" onclick="download_csv_file()" id="btndownload">DESCARGAR CSV</button>

            </div>
          </div>
     
        

        <button onclick="addrow()" id="btnadd"> Agregar </button> 
        <button onclick="download_csv_file()" id="btndownload"> Descargar CSV </button> 

        <script>  
            //create CSV file data in an array

            var csvFileDataMoodle = [];
            var csvFileDataOffice = [];
            document.getElementById("btndownload").disabled = true;

            function addrow() {
                if (document.getElementById("user").value != "" && document.getElementById("first").value != "" && document.getElementById("last").value != ""){
                    if(document.getElementById("cbmoodle").checked == true || document.getElementById("cboffice").checked == true){
                        if(document.getElementById("cbmoodle").checked == true){
                            csvFileDataMoodle.push([
                                document.getElementById("user").value,
                                '123456',
                                document.getElementById("first").value,
                                document.getElementById("last").value,
                                document.getElementById("user").value+'@tij.xochicalco.edu.mx',
                                'Tijuana'
                            ]);
                        }

                        if(document.getElementById("cboffice").checked == true){
                            csvFileDataOffice.push([
                                document.getElementById("user").value+'@tij.xochicalco.edu.mx',
                                document.getElementById("first").value,
                                document.getElementById("last").value,
                                document.getElementById("first").value+' '+document.getElementById("last").value,
                                'Alumno',
                                '',
                                '',
                                '',
                                '',
                                '',
                                '',
                                '',
                                '',
                                '',
                                '',
                                ''
                            ]);
                        }

  
                        document.getElementById("user").value = "";
                        document.getElementById("first").value = "";
                        document.getElementById("last").value = "";

                        document.getElementById("user").focus();

                        document.getElementById("btndownload").disabled = false;
                    }      
                    else{
                        alert("Seleccione al menos una opción para agregar alumnos");
                    }
                }
                else{
                    alert("Debe rellenar todos los campos");
                }
            }
                
            //create a user-defined function to download CSV file   
            function download_csv_file() {  

                //cbMoodle
                //cbOffice

                if(csvFileDataMoodle.length > 0){
                    //define the heading for each row of the data
                    var csv = 'username,password,firstname,lastname,email,city\n';  

                    //merge the data with CSV  
                    csvFileDataMoodle.forEach(function(row) {  
                        csv += row.join(',');  
                        csv += "\n";  
                    });
                    
                    var hiddenElement = document.createElement('a');  
                    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
                        
                    //provide the name for the CSV file to be downloaded  
                    hiddenElement.download = 'alta-moodle.csv';  
                    hiddenElement.click();  
                }

                if(csvFileDataOffice.length > 0){
                    var csv = 'Nombre de usuario,Nombre,Apellido,Nombre para mostrar,Puesto,Departamento,Número del trabajo,Teléfono de la oficina,Teléfono móvil,Fax,Dirección de correo electrónico alternativa,Dirección,Ciudad,Estado o provincia,Código postal,País o región\n';  

                    //merge the data with CSV  
                    csvFileDataOffice.forEach(function(row) {
                        csv += row.join(',');
                        csv += "\n";  
                    });

                    var hiddenElement = document.createElement('a');  
                    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);

                    //provide the name for the CSV file to be downloaded  
                    hiddenElement.download = 'alta-office.csv';  
                    hiddenElement.click();
                }
            }

            //lowercase function
            function minus(e) {
                e.value = e.value.toLowerCase();
            }

        </script>  


<!--         
        <button onclick="addrow()"> Agregar </button> 
        <button onclick="download_csv_file()"> Descargar CSV </button>  -->


        <script type="text/javascript" src="js/mdb.min.js"></script>
        <!-- Custom scripts -->
        <script type="text/javascript"></script>


    </body>
</html>